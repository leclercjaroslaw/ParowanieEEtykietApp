<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EAN Scanner v1.8</title>
    <meta name="theme-color" content="#ffffff">
    
    <link rel="manifest" href="manifest.json">

    <!-- 1. Biblioteki zewnƒôtrzne -->
    <!-- Html5-Qrcode -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script> 
    <!-- 2. Nasz plik z logikƒÖ (musi byƒá defer) -->
    <script src="app.js" defer></script>
    
    <style>
        :root {
            --bg-light: #f0f2f5; --text-light: #333; --btn-light: #007bff; --btn-hover-light: #0056b3; --cont-light: #fff; --border-light: #ccc;
            --bg-dark: #2c2c2c; --text-dark: #f1f1f1; --btn-dark: #0056b3; --btn-hover-dark: #003d80; --cont-dark: #3a3a3a; --border-dark: #555;
        }

        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light); 
            color: var(--text-light); 
            transition: background-color 0.3s, color 0.3s; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
        }
        
        body.dark { background-color: var(--bg-dark); color: var(--text-dark); }

        .App { width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; text-align: center; }
        
        body.scan-success { animation: flash-green 0.5s; }
        @keyframes flash-green { 0% { background-color: lightgreen; } 100% { background-color: inherit; } }

        select, button { font-size: 1rem; padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid var(--border-light); }
        button { background-color: var(--btn-light); color: white; border: none; cursor: pointer; }
        button:hover { background-color: var(--btn-hover-light); }
        
        body.dark select { background-color: var(--cont-dark); color: var(--text-dark); border-color: var(--border-dark); }
        body.dark button { background-color: var(--btn-dark); }

        #reader { width: 100%; border: 2px solid var(--border-light); border-radius: 8px; overflow: hidden; margin: 20px 0; background: black; }
        body.dark #reader { border-color: var(--border-dark); }

        .result-box { margin-top: 20px; padding: 15px; border-radius: 8px; background-color: var(--cont-light); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        body.dark .result-box { background-color: var(--cont-dark); }
        
        .status-msg { font-weight: bold; margin-top: 10px; }
        .status-success { color: green; }
        .status-error { color: red; }
        body.dark .status-success { color: lightgreen; }
        body.dark .status-error { color: #ff6b6b; }

        .footer-link { margin-top: 30px; font-size: 0.8rem; opacity: 0.8; }
        .footer-link a { color: inherit; text-decoration: underline; }
    </style>
</head>

<!-- WA≈ªNE: Usuniƒôto nawiasy (), teraz jest po prostu "scannerApp" -->
<body x-data="scannerApp" :class="{ 'dark': darkMode, 'scan-success': flashSuccess }">
    
    <div class="App">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 20px;">
            <h3 style="margin:0;">EAN Scanner v1.8</h3>
            <button @click="toggleDarkMode" x-text="darkMode ? '‚òÄÔ∏è Tryb Jasny' : 'üåô Tryb Ciemny'"></button>
        </div>

        <select x-model="scanMode" @change="handleModeChange" style="width: 100%;">
            <option value="ean">üîç Skaner kod√≥w EAN (WWW)</option>
            <option value="pairing">üîó Parowanie E-etykiet</option>
            <option value="bakery">ü•ñ E-etykiety piekarnia</option>
        </select>

        <button x-show="installable" @click="handleInstallClick" style="width: 100%; background-color: #28a745; margin-top: 10px;">
            üì≤ Zainstaluj aplikacjƒô
        </button>

        <div id="reader"></div>

        <template x-if="scanMode === 'ean'">
            <div class="result-box">
                <p>Ostatni kod: <b x-text="lastScannedCode || '...'"></b></p>
                <a x-show="lastScannedCode" 
                   :href="`${CONFIG.PHP_URL}?ean=${lastScannedCode}&webApp=1`" 
                   target="_blank"
                   class="button" style="display:inline-block; padding:10px; background:var(--btn-light); color:white; text-decoration:none; border-radius:5px; margin-top:10px;">
                   Otw√≥rz w wyszukiwarce
                </a>
            </div>
        </template>

        <template x-if="scanMode === 'pairing'">
            <div class="result-box">
                <p>Produkt (EAN): <b x-text="scannedProduct || '-'"></b></p>
                <p>Etykieta (ID): <b x-text="scannedEtiquette || '-'"></b></p>
                <p class="status-msg" :class="pairingStatus.type" x-text="pairingStatus.msg"></p>
                <button x-show="scannedProduct || scannedEtiquette" @click="resetPairing">Wyczy≈õƒá</button>
            </div>
        </template>

        <template x-if="scanMode === 'bakery'">
            <div class="result-box">
                <p>Etykieta: <b x-text="scannedEtiquette || '-'"></b></p>
                <div x-show="scannedEtiquette">
                    <input
                        x-model="bakerySearchQuery"
                        type="search"
                        placeholder="Szukaj produktu (nazwa lub EAN)‚Ä¶"
                        style="width:100%; font-size:1rem; padding:10px; margin:5px; border-radius:5px; border:1px solid var(--border-light); box-sizing:border-box;"
                    />
                    <select x-model="selectedBakeryProduct" style="width:100%">
                        <option value="">-- Wybierz produkt --</option>
                        <template x-for="product in filteredBakeryProducts" :key="product.ean">
                            <option :value="product.ean" x-text="product.name"></option>
                        </template>
                    </select>
                    <p x-show="bakerySearchQuery && filteredBakeryProducts.length === 0" style="margin:5px 0; font-size:0.9rem; opacity:0.8;">
                        Brak wynik√≥w.
                    </p>
                    <button @click="pairBakeryProduct" :disabled="!selectedBakeryProduct" style="margin-top:10px; width:100%">Paruj</button>
                </div>
                <p class="status-msg" :class="pairingStatus.type" x-text="pairingStatus.msg"></p>
            </div>
        </template>

        <div class="footer-link">
            API Link: 
            <a :href="CONFIG.API_URL" target="_blank" x-text="CONFIG.API_URL"></a>
        </div>
    </div>
    <!-- Alpine.js (musi byƒá defer) -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>
